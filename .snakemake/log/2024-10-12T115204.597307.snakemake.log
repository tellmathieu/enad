Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 20
Rules claiming more threads will be scaled down.
Provided resources: mem_mb=50000
Job stats:
job                                    count
-----------------------------------  -------
BUSCOanalysis                              1
alignToChainOfGenomes                      5
alignToReference                           6
all                                        1
buscoRscript                               1
changeNCtoChr                              6
combineBUSCO                               1
compareRef                                 6
de_novo_gfa_to_fa                          1
initial_assembly                           1
makeGenomeFileForPlotSR                    6
makeGenomeFileForPlotSRCombined            1
parseBUSCO                                 1
plotStructuralRearrangement                6
plotStructuralRearrangementCombined        1
removeRagTag                               6
sameChrNames                               6
syntenyAnalysis                            6
syntenyAnalysisForCombined                 5
total                                     67

Select jobs to execute...

[Sat Oct 12 11:52:08 2024]
rule makeGenomeFileForPlotSRCombined:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/reference_genome_chr_only.fa
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/syri_genomes.txt
    jobid: 88
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/syri_genomes.txt
    resources: tmpdir=/tmp


    echo "#file  name" > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/syri_genomes.txt
    echo "/group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/reference_genome_chr_only.fa	reference	lw:1.5" >> /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/syri_genomes.txt
    COMPS=(horse_04_56 horse_05_608 horse_06_1212 horse_01_200 horse_02_205 horse_03_238)
    for sample in ${COMPS[@]}
      do
        echo "/group/ctbrowngrp/finnolab_shared/eNAD_PacBio/$sample/${sample}_scaffold_chr_only.fa	$sample	lw:1.5" >> /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/syri_genomes.txt
      done
  

[Sat Oct 12 11:52:08 2024]
rule initial_assembly:
    input: /home/tmathieu/eNAD/fastq/horse_01_200.fastq
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.gfa
    jobid: 20
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.gfa
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp, mem_mb=50000, mem_mib=47684


    mkdir -p /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200
    
    #de novo assembly
    hifiasm -o /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm -t 20 /home/tmathieu/eNAD/fastq/horse_01_200.fastq
  
[Sat Oct 12 11:52:08 2024]
Finished job 88.
1 of 67 steps (1%) done
[Sun Oct 13 10:23:09 2024]
Finished job 20.
2 of 67 steps (3%) done
Select jobs to execute...

[Sun Oct 13 10:23:09 2024]
rule de_novo_gfa_to_fa:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.gfa
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa
    jobid: 19
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.gfa
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp


    #convert the output gfa file to a traditional fasta file
    awk '/^S/{print ">"$2;print $3}' /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.gfa > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa
  
[Sun Oct 13 10:23:28 2024]
Finished job 19.
3 of 67 steps (4%) done
Select jobs to execute...

[Sun Oct 13 10:23:28 2024]
rule BUSCOanalysis:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/run_laurasiatheria_odb10/full_table.tsv
    jobid: 18
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/run_laurasiatheria_odb10/full_table.tsv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp, mem_mb=50000, mem_mib=47684


    busco -c 20 --metaeuk       --metaeuk_parameters="--disk-space-limit=1000M,--remove-tmp-files=1"       --metaeuk_rerun_parameters="--disk-space-limit=1000M,--remove-tmp-files=1"       -i /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa       -o horse_01_200       -m genome       -f       -l laurasiatheria_odb10
  
[Sun Oct 13 18:46:13 2024]
Finished job 18.
4 of 67 steps (6%) done
Select jobs to execute...

[Sun Oct 13 18:46:13 2024]
rule parseBUSCO:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/run_laurasiatheria_odb10/full_table.tsv
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv
    jobid: 17
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/run_laurasiatheria_odb10/full_table.tsv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp


    echo "Strain,Complete_single_copy,Complete_duplicated,Fragmented,Missing" > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv

    cat /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt | grep "(S)" | awk -v strain="horse_01_200" '{print strain","$1}' > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/complete_single.txt

    cat /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt | grep "(D)" | awk '{print $1}' > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/complete_duplicated.txt

    cat /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt | grep "(F)" | awk '{print $1}' > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/fragmented.txt

    cat /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/short_summary.specific.laurasiatheria_odb10.horse_01_200.txt | grep "(M)" | awk '{print $1}' > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/missing.txt

    paste -d "," /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/complete_single.txt /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/complete_duplicated.txt /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/fragmented.txt /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/missing.txt >> /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv

    rm /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/complete_single.txt /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/complete_duplicated.txt /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/fragmented.txt /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/missing.txt
  
[Sun Oct 13 18:46:13 2024]
Finished job 17.
5 of 67 steps (7%) done
Select jobs to execute...

[Sun Oct 13 18:46:13 2024]
rule combineBUSCO:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/busco.csv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_04_56/busco.csv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_06_1212/busco.csv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_05_608/busco.csv, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_02_205/busco.csv
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv
    jobid: 8
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv
    resources: tmpdir=/tmp


    echo "Strain,Complete_single_copy,Complete_duplicated,Fragmented,Missing" > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv
    cat /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/busco.csv /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_04_56/busco.csv /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/busco.csv /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_06_1212/busco.csv /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_05_608/busco.csv /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_02_205/busco.csv | sort | uniq -u >> /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv
  
[Sun Oct 13 18:46:13 2024]
Finished job 8.
6 of 67 steps (9%) done
Select jobs to execute...

[Sun Oct 13 18:46:13 2024]
rule buscoRscript:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf
    jobid: 7
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv
    resources: tmpdir=/tmp


    Rscript /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/scripts/busco.R       /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/combinedBusco.csv       /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf
  
[Sun Oct 13 18:46:26 2024]
Finished job 7.
7 of 67 steps (10%) done
Select jobs to execute...

[Sun Oct 13 18:46:27 2024]
rule compareRef:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa, /home/tmathieu/eNAD/resources/GCF_002863925.1_EquCab3.0_genomic.fna
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/ragtag.scaffold.fasta
    jobid: 50
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/ragtag.scaffold.fasta; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp, mem_mb=50000, mem_mib=47684


    ragtag.py scaffold       -u       -o horse_01_200       /home/tmathieu/eNAD/resources/GCF_002863925.1_EquCab3.0_genomic.fna       /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_01_200/horse_01_200.asm.bp.p_ctg.fa
  
[Sun Oct 13 19:14:31 2024]
Finished job 50.
8 of 67 steps (12%) done
Select jobs to execute...

[Sun Oct 13 19:14:31 2024]
rule compareRef:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_03_238/horse_03_238.asm.bp.p_ctg.fa, /home/tmathieu/eNAD/resources/GCF_002863925.1_EquCab3.0_genomic.fna
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/ragtag.scaffold.fasta
    jobid: 6
    reason: Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf
    wildcards: sample=horse_03_238
    resources: tmpdir=/tmp, mem_mb=50000, mem_mib=47684


    ragtag.py scaffold       -u       -o horse_03_238       /home/tmathieu/eNAD/resources/GCF_002863925.1_EquCab3.0_genomic.fna       /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_03_238/horse_03_238.asm.bp.p_ctg.fa
  

[Sun Oct 13 19:14:31 2024]
rule removeRagTag:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/ragtag.scaffold.fasta
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_rename.scaffold.fasta
    jobid: 49
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_rename.scaffold.fasta; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/ragtag.scaffold.fasta
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp


    sed 's/_RagTag//' /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/ragtag.scaffold.fasta > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_rename.scaffold.fasta
  
[Sun Oct 13 19:14:48 2024]
Finished job 49.
9 of 67 steps (13%) done
Select jobs to execute...

[Sun Oct 13 19:14:48 2024]
rule sameChrNames:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_rename.scaffold.fasta, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/chr.accesssion.list.txt, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/cleaned_ref_genome.fa
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr.fa
    jobid: 48
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr.fa; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_rename.scaffold.fasta; Code has changed since last execution
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp


    horse_01_200lines=$(wc -l /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/chr.accesssion.list.txt | awk '{ print $1 }')
    horse_01_200currentline=1
    while [ "$horse_01_200currentline" -le "$horse_01_200lines" ]
    do
      horse_01_200name=$(sed "${horse_01_200currentline}q;d" /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/chr.accesssion.list.txt | awk '{ print $2 }')
      grep -A1 "${horse_01_200name}" /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_rename.scaffold.fasta >> /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr.fa
      horse_01_200currentline=$(($horse_01_200currentline+1))
    done
  
[Sun Oct 13 19:15:40 2024]
Finished job 6.
10 of 67 steps (15%) done
Select jobs to execute...

[Sun Oct 13 19:15:40 2024]
rule compareRef:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_02_205/horse_02_205.asm.bp.p_ctg.fa, /home/tmathieu/eNAD/resources/GCF_002863925.1_EquCab3.0_genomic.fna
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_02_205/ragtag.scaffold.fasta
    jobid: 74
    reason: Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/busco.pdf
    wildcards: sample=horse_02_205
    resources: tmpdir=/tmp, mem_mb=50000, mem_mib=47684


    ragtag.py scaffold       -u       -o horse_02_205       /home/tmathieu/eNAD/resources/GCF_002863925.1_EquCab3.0_genomic.fna       /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/outputGenomes/horse_02_205/horse_02_205.asm.bp.p_ctg.fa
  

[Sun Oct 13 19:15:40 2024]
rule removeRagTag:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/ragtag.scaffold.fasta
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/horse_03_238_rename.scaffold.fasta
    jobid: 5
    reason: Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/ragtag.scaffold.fasta
    wildcards: sample=horse_03_238
    resources: tmpdir=/tmp


    sed 's/_RagTag//' /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/ragtag.scaffold.fasta > /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_03_238/horse_03_238_rename.scaffold.fasta
  
[Sun Oct 13 19:15:48 2024]
Finished job 48.
11 of 67 steps (16%) done
Select jobs to execute...

[Sun Oct 13 19:15:48 2024]
rule changeNCtoChr:
    input: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr.fa, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/resources/chr.accesssion.list.txt
    output: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr_only.fa, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_ref_chr_only.fa
    jobid: 47
    reason: Missing output files: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr_only.fa, /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_ref_chr_only.fa; Input files updated by another job: /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/horse_01_200/horse_01_200_scaffold_chr.fa
    wildcards: sample=horse_01_200
    resources: tmpdir=/tmp

RuleException in rule changeNCtoChr in file /group/ctbrowngrp/finnolab_shared/eNAD_PacBio/hifi_assembly_analysis.smk, line 260:
AttributeError: 'InputFiles' object has no attribute 'refChr', when formatting the following:

    cp {input.ragtagChr} {output.ragtagChr2}
    cp {input.refChr} {output.refChr2}
    {wildcards.sample}lines=$(wc -l {input.chrNameList} | awk '{{ print $1 }}')
    {wildcards.sample}currentline=1
    while [ "${wildcards.sample}currentline" -le "${wildcards.sample}lines" ]
    do
      {wildcards.sample}chr=$(sed "${{{wildcards.sample}currentline}}q;d" {input.chrNameList} | awk '{{ print $1 }}')
      {wildcards.sample}nc=$(sed "${{{wildcards.sample}currentline}}q;d" {input.chrNameList} | awk '{{ print $2 }}')
      sed -i "s/${{{wildcards.sample}nc}}/${{{wildcards.sample}chr}}/g" {output.ragtagChr2}
      sed -i "s/${{{wildcards.sample}nc}}/${{{wildcards.sample}chr}}/g" {output.refChr2}
      {wildcards.sample}currentline=$((${wildcards.sample}currentline+1))
    done
  
